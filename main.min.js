function onDrag(t){if(stop=!1,$(t.target).offset().left<$(".date_1").offset().left)return $(t.target).position({left:step_w}),!1;var e=$(t.target).offset().left;$(".highlight").width(e+step_w+3)}function onDragStop(t){var e=$(t.target).offset().left;$(".highlight").width(e+step_w+3),updateMap()}function updateMap(){$(".dates li").each(function(t,e){var a=$(".handle").position().left;if(a<$($(".dates li")[1]).position().left){stop=!0;var e=$($(".dates li")[0]).text();sublayer&&sublayer.setSQL("SELECT * FROM shootings_all_copy WHERE date ="+(parseInt(e)+1))}if(a>=$($(".dates li")[$(".dates li").length-1]).position().left){stop=!0;var e=$($(".dates li")[$(".dates li").length-1]).text();sublayer&&sublayer.setSQL("SELECT * FROM shootings_all_copy WHERE date ="+(parseInt(e)+1))}if(t>0&&t<$(".dates li").length-1){if(stop)return!1;if(a>$($(".dates li")[t-1]).position().left&&a<$($(".dates li")[t+1]).position().left){stop=!0;var e=$($(".dates li")[t]).text();sublayer&&sublayer.setSQL("SELECT * FROM shootings_all_copy WHERE date ="+(parseInt(e)+1))}}})}function init(){map=new L.Map("cartodb_map",{center:[40.702043,-73.892831],zoom:10}),map.scrollWheelZoom.disable(),L.tileLayer("https://dnv9my2eseobd.cloudfront.net/v3/cartodb.map-4xtxp73f/{z}/{x}/{y}.png",{attribution:'Mapbox <a href="http://mapbox.com/about/maps" target="_blank">Terms &amp; Feedback</a>'}).addTo(map),layerUrl="https://leekristena.cartodb.com/api/v2/viz/a0238a8a-06e0-11e4-aff5-0e73339ffa50/viz.json",cartodb.createLayer(map,layerUrl,{https:!0}).addTo(map).on("done",function(t){sublayer=t.getSubLayer(0),sublayer.infowindow.set("template",$("#infowindow_template").html())}).on("error",function(){console.log("some error occurred")}),$(document).ready(function(){workingSpace=.95*$(window).width(),step_w=width=workingSpace/$("#slider .dates li").length,$("#slider .dates li").width(width),$(".handle").width(width),$("#slider .dates li").click(function(){value_highlight=$(this).offset().left+step_w+3,value=$(this).position().left+$(this).width()-step_w,$(".handle").animate({left:value+"px"},900),$(".highlight").animate({width:value_highlight+"px"},900),console.log($(this).html()),sublayer&&sublayer.setSQL("SELECT * FROM shootings_all_copy WHERE date ="+parseInt($(this).html())),$(".cartodb-infowindow").hide()}),$("#slider ul > li.date_1").click(),$("#selector select").change(function(){$("select option:selected").each(function(){value=$(this).offset().left-$(this).width()/12,$(".highlight").animate({left:value+"px",width:2.3*$(this).width()+"px"},900),console.log($(this).html()),sublayer&&sublayer.setSQL("SELECT * FROM shootings_all_copy WHERE date ="+parseInt($(this).html()))})}),$("#slider .handle").draggable({containment:"parent",axis:"x",drag:onDrag,snap:".dates li",snapMode:"inner",snapTolerance:step_w,stop:onDragStop})}),$(window).on("resize",function(){$(".highlight").width($(".handle").offset().left+step_w)})}var map,layerUrl,sublayer,step_w,stop=!0;
